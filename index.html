<!-- HTML: Aggiungi il pulsante "Esegui tutte" nel pannello delle animazioni -->
<div id="animationContainer">
    <div class="panel" id="animationPanel">
        <div class="panel-header">Animazioni</div>
        <div class="panel-content" id="animationControls">
            <button id="stopButton">Ferma</button>
            <button id="playAllButton">Esegui tutte</button> <!-- Nuovo pulsante -->
            <!-- Pulsanti animazioni aggiunti dinamicamente -->
        </div>
    </div>
</div>

<script>
    // ... (il resto del codice rimane invariato fino al caricamento del modello)

    // Variabili globali (aggiungi questa per tracciare la sequenza)
    let isPlayingAll = false;

    // Funzione per eseguire tutte le animazioni in sequenza
    function playAllAnimationsSequentially() {
        if (mixer && actions.length > 0 && !isPlayingAll) {
            isPlayingAll = true;
            let currentIndex = 0;

            function playNext() {
                if (currentIndex >= actions.length) {
                    isPlayingAll = false;
                    return;
                }

                const action = actions[currentIndex];
                action.reset(); // Resetta l'animazione al frame iniziale
                action.play();

                // Listener per passare alla successiva quando finisce
                mixer.addEventListener('finished', function onFinished(e) {
                    if (e.action === action) {
                        mixer.removeEventListener('finished', onFinished); // Rimuovi listener
                        currentIndex++;
                        playNext();
                    }
                });
            }

            playNext();
        }
    }

    // Modifica alla funzione playAnimation per evitare loop
    function playAnimation(index) {
        if (mixer && actions[index]) {
            actions.forEach(action => action.stop());
            const action = actions[index];
            action.setLoop(THREE.LoopOnce); // Imposta esecuzione singola
            action.clampWhenFinished = true; // Ferma al frame finale
            action.reset(); // Resetta al frame iniziale
            action.play();
        }
    }

    // Carica il modello GLB (modifica questa parte)
    loader.load(
        'https://raw.githubusercontent.com/sandropertini/Models/main/W037089_ASM_AN.glb',
        function (gltf) {
            model = gltf.scene;
            scene.add(model);

            // Inizializza il mixer per le animazioni
            mixer = new THREE.AnimationMixer(model);

            // Aggiungi pulsanti per le animazioni
            gltf.animations.forEach((clip, index) => {
                const action = mixer.clipAction(clip);
                action.setLoop(THREE.LoopOnce); // Imposta esecuzione singola
                action.clampWhenFinished = true; // Ferma al frame finale
                actions.push(action);
                const button = document.createElement('button');
                button.textContent = clip.name || `Animazione ${index}`;
                button.addEventListener('click', () => playAnimation(index));
                animationControls.appendChild(button);
            });

            if (gltf.animations.length === 0) {
                console.log("Nessuna animazione trovata nel modello.");
            }

            // Aggiungi evento al pulsante "Esegui tutte"
            document.getElementById('playAllButton').addEventListener('click', playAllAnimationsSequentially);

            // ... (il resto della gestione BOM rimane invariato)
        },
        function (xhr) {
            console.log((xhr.loaded / xhr.total * 100) + '% caricato');
        },
        function (error) {
            console.error('Errore durante il caricamento:', error);
        }
    );

    // ... (il resto del codice rimane invariato)
</script>
